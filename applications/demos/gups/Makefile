GRAPPA_HOME?=$(shell /bin/bash -c '(while [[ ! -e include.mk && "`pwd`" != "/" ]]; do cd ..; done; pwd )')
# check if autodetect GRAPPA_HOME is consistent
AUTO_HOME=$(shell /bin/bash -c '(while [[ ! -e include.mk && "`pwd`" != "/" ]]; do cd ..; done; pwd )')
ifneq ($(GRAPPA_HOME), $(AUTO_HOME))
$(warning warning: Environment variable GRAPPA_HOME was set but does not match the autodetected home: env=$(GRAPPA_HOME), auto=$(AUTO_HOME))
endif

#include common Grappa definitions
include $(GRAPPA_HOME)/include.mk

TARGET:= gups.exe

#default rule: just build TARGET
$(TARGET):

CFLAGS += -w
CFLAGS += -I$(GRAPPA_HOME)/system -I.. 
CFLAGS += -g -Wall -Drestrict=__restrict__ -ffast-math

LDFLAGS += -g 

include $(GRAPPA_HOME)/system/Makefile

$(GRAPPA_HOME)/system/libGrappa.a: force
	cd $(GRAPPA_HOME)/system; $(MAKE) lib

force: ;

allclean: clean
	pushd $(GRAPPA_HOME)/system; $(MAKE) clean; popd







gups.exe gups.o: $(GRAPPA_HOME)/system/libGrappa.a

gups1.exe gups1.o: $(GRAPPA_HOME)/system/libGrappa.a
gups2.exe gups2.o: $(GRAPPA_HOME)/system/libGrappa.a
gups3.exe gups3.o: $(GRAPPA_HOME)/system/libGrappa.a
gups4.exe gups4.o: $(GRAPPA_HOME)/system/libGrappa.a
gups5.exe gups5.o: $(GRAPPA_HOME)/system/libGrappa.a


gups-lcg.exe gups-lcg.o: $(GRAPPA_HOME)/system/libGrappa.a


